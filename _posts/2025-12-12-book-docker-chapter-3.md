---
title: "[도커 교과서] 3장 도커의 기본적인 사용법"
date: 2025-12-12 16:29:00 +0900
categories: [Study, Docker]
tags: [Docker]
---

# 3장 도커 이미지 만들기

## 학습 목표

- 도커 이미지를 만드는 방법을 학습한다.
- Dockerfile 문법에 대해 학습한다.
- 애플리케이션 컨테이너화에 쓰이는 주요 패턴을 학습한다.

## 3.1 도커 허브에 공유된 이미지 사용하기

도커 CLI를 통해 명시적으로 원하는 이미지를 내려받을 수 있다.

```bash
docker image pull {원하는 이미지}
```

도커 이미지는 물리적으로 여러 개의 작은 파일로 구성되어 있는 논리적인 하나의 대상

도커가 해당 파일들을 조립해 컨테이너의 내부 파일 시스템을 만듦

```bash
docker container run --name {원하는 컨테이너명} {도커 이미지}
```

**—name: 컨테이너에 원하는 이름을 붙이고 해당 이름으로 컨테이너를 지칭할 수 있음**

**도커 이미지는 설정값의 기본값을 포함하여 패키징되지만, 컨테이너를 실행할 때 이 설정값을 바꿀 수 있어야함**

**환경변수**: 운영체제에서 제공하는 키-값 쌍

도커 컨테이너는 호스트 운영체제의 것이 아닌 도커가 부여하는 별도의 환경 변수를 가질 수 있음. 

## 3.2 Dockerfile 작성하기

**Dockerfile**: 애플리케이션을 패키징하기 위한 간단한 스크립트

**일련의 인스트럭션으로 구성**되어 있어, 인스트럭션을 실행한 결과로 도커 이미지가 생성됨

**FROM**

- 다른 이미지를 가져오는 인스트럭션 ex) FROM diamol/node

**ENV**

- 환경 변수 값을 지정하기 위한 인스트럭션 ex) ENV TARGET=”google.com”
- 값을 지정하기 위한 키-값 형식

**WORKDIR**

- 컨테이너 이미지 파일 시스템에 디렉터리 생성, 해당 디렉터리를 작업 디렉터리로 지정하는 인스트럭션
- 리눅스와 윈도우 컨테이너 모두 구분자로 슬래시 사용 ex) WORKDIR /main

**COPY**

- 로컬 파일 시스템의 파일/디렉터리를 컨테이너 이미지로 복사하는 인스트럭션
- COPY [원본 경로] [복사 경로] ex) COPY app.js .

**CMD**

- 도커가 이미지로부터 컨테이너를 실행했을 때, 실행할 명령어를 지정하는 인스트럭션
ex) CMD [”node”, “/web-ping/app.js”]

## 3.3 컨테이너 이미지 빌드하기

```bash
# 이미지를 빌드하기 위해선, Dockerfile, 이미지의 이름, 패키징에 필요한 파일의 경로가 필요
docker image build --tag {이미지 이름} {Dockerfile 및 패키징에 필요한 파일의 경로}

# 모든 이미지 목록 확인
docker image ls
```

빌드된 이미지는 로컬 이미지 캐시에 저장

## 3.4 도커 이미지와 이미지 레이어 이해하기

**도커 이미지**

- 패키징에 포함시킨 모든 파일이 존재
- 자신에 대한 여러 메타데이터 정보 존재
- 이미지 레이어가 모인 논리적 대상

**이미지 레이어**

- Dockerfile 인스트럭션과 1:1 관계
- 도커 엔진의 캐시에 물리적으로 저장된 파일
- 여러 이미지와 컨테이너에서 공유

이미지의 논리적 용량과 실제로 차지하는 디스크 용량은 다르다, 이미지 레이어가 여러 도커 이미지에서 재사용되면 실제로 차지하는 디스크 용량이 논리적 용량보다 적다.

## 3.5 이미지 레이어 캐시를 이용한 Dockerfile 스크립트 최적화

Dockerfile 스크립트의 인스트럭션은 각각 하나의 이미지 레이어와 1:1로 연결
하지만, **인스트럭션의 결과가 이전 빌드와 같다면** 인스트럭션을 실행하지 않고, 이전에 캐시된 레이어를 재사용

캐시에 일치하는 레이어가 있는지 확인하기 위해 해시값을 사용, **Dockerfile 스크립트의 인스트럭션**과 **인스트럭션에 의해 복사되는 파일의 내용**을 통해 해시값을 계산

한번 인스트럭션이 실행되면 그 다음에 오는 인스트럭션은 수정되지 않았더라도 모두 실행됨. → 최적화 필요

Dockerfile 스크립트의 인스터럭션을 **잘 수정하지 않는 인스트럭션이 앞으로** 오고 **자주 수정되는 인스트럭션이 뒤**에 오도록 재배치하여 최적화 진행

**FROM → CMD → ENV (정규식(\)을 활용하여 연결) → WORKDIR → COPY 
절대적이지 않지만 수정이 별로 없는 순서**

## 3.6 연습 문제

Dockerfile 스크립트 없이 도커 이미지 생성

```bash
# diamol/ch03-lab 이미지를 실행하는 ch03 컨테이너와 대화식으로 컨테이너 실행
docker run --interactive --tty --name ch03 diamol/ch03-lab

# ch03 컨테이너 내부에서 vi로 ch03.txt 파일 수정
/diamol # vi ch03.txt

# ch03 컨테이너를 통해 my/ch03-lab 라는 새로운 이미지 생성 
docker commit ch03 my/ch03-lab

# my/ch03-lab 이미지를 실행하는 컨테이너를 대화식으로 실행
docker run --interactive --tty my/ch03-lab

# 컨테이너 내부에서 ch03-lab 이미지의 파일이 잘 수정된 채로 새로운 이미지가 생성됐는지 확인
/diamol # ls
ch03.txt
/diamol # cat ch03.txt
Lab solution, by: Lee Jaeseok
```